{% extends "main.html" %}

{% block content%}

<!-- Main Section -->
<main class="singleProject my-md">
    <div class="container">
        <div class="column column--2of3">
          <!-- <img class="singleProject__preview" src="{{ dataset.dataset_image.url }}" alt="portfolio thumbnail" /> -->
          <!-- <a href="profile.html" class="singleProject__developer">Ben @ Insightsaurus</a> -->
          <h2 class="singleProject__title">{{dataset.title}}</h2>
          <h3 class="singleProject__subtitle">About the Dataset</h3>
          <div class="singleProject__info">
            {{dataset.description}}
          </div>

            <!-- CHARTS SECTION, JAPAN -->
            {% if chart_data %}
            <!-- BIRTH TOTAL -->
            <div>
              <canvas id="myChart"></canvas>
            </div>
            
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            
            <script>
              const ctx = document.getElementById('myChart');
            
              new Chart(ctx, {
                type: 'bar',
                data: {
                  labels: [{% for data in chart_data %} '{{data.year}}', {% endfor %}],
                  datasets: [{
                    label: 'Birth Total',
                    data: [{% for data in chart_data %} '{{data.birth_total}}', {% endfor %}],
                    borderWidth: 1
                  }]
                },
                options: {
                  scales: {
                    y: {
                      beginAtZero: true
                    }
                  }
                }
              });
            </script>            
            {% endif %}
            <br>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut et sodales mi. Sed ut tempor erat. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Aliquam tincidunt consectetur risus, vel hendrerit justo suscipit in. Aenean pretium leo mi. Duis sollicitudin, ante a porta blandit, erat sem tempor nulla, id finibus nisi eros sit amet odio</p>
            <br>

            <!-- BY GENDER -->
            
            {% if chart_data %}
            <div>
              <canvas id="myChart2"></canvas>
            </div>
            
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            
            <script>
            const ctx2 = document.getElementById('myChart2');
            
            new Chart(ctx2, {
              type: 'line',
              data: {
                labels: [
                  {% for data in chart_data %} '{{ data.year }}', {% endfor %}
                ],
                datasets: [
                  {
                    label: 'Male Births',
                    data: [
                      {% for data in chart_data %} '{{ data.birth_male }}', {% endfor %}
                    ],
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                  },
                  {
                    label: 'Female Births',
                    data: [
                      {% for data in chart_data %} '{{ data.birth_female }}', {% endfor %}
                    ],
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)', 
                    borderWidth: 1
                  }
                ]
              },
              options: {
                scales: {
                  y: {
                    beginAtZero: true
                  }
                }
              }
            });
            </script>
            {% endif %}
            <br>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut et sodales mi. Sed ut tempor erat. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Aliquam tincidunt consectetur risus, vel hendrerit justo suscipit in. Aenean pretium leo mi. Duis sollicitudin, ante a porta blandit, erat sem tempor nulla, id finibus nisi eros sit amet odio</p>
            <br>

            <!-- BY BIRTH_RATE -->
            {% if chart_data %}
            <div>
              <canvas id="myChart3"></canvas>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

            <script>
            const ctx3 = document.getElementById('myChart3');
            new Chart(ctx3, {
              type: 'line',
              data: {
                labels: [
                  {% for data in chart_data %}
                  '{{ data.year }}',
                  {% endfor %}
                ],
                datasets: [
                  {
                    label: 'Birth Rate',
                    data: [
                      {% for data in chart_data %}
                      '{{ data.birth_rate }}',
                      {% endfor %}
                    ],
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderWidth: 1
                  }
                ]
              },
              options: {
              }
            });
            </script>
            {% endif %}
            <br>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut et sodales mi. Sed ut tempor erat. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Aliquam tincidunt consectetur risus, vel hendrerit justo suscipit in. Aenean pretium leo mi. Duis sollicitudin, ante a porta blandit, erat sem tempor nulla, id finibus nisi eros sit amet odio</p>
            <br>

            <!-- POPULATION TOTAL -->
            {% if chart_data %}
            <div>
              <canvas id="myChart4"></canvas>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

            <script>
            const ctx4 = document.getElementById('myChart4');
            new Chart(ctx4, {
              type: 'line',
              data: {
                labels: [
                  {% for data in chart_data %}
                  '{{ data.year }}',
                  {% endfor %}
                ],
                datasets: [
                  {
                    label: 'Population Total',
                    data: [
                      {% for data in chart_data %}
                      '{{ data.population_total }}',
                      {% endfor %}
                    ],
                    borderColor: 'rgba(96, 87, 168, 1)',
                    backgroundColor: 'rgba(96, 87, 168, 0.2)', 
                    borderWidth: 1
                  }
                ]
              },
              options: {
                
              }
            });
            </script>
            {% endif %}
            <br>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut et sodales mi. Sed ut tempor erat. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Aliquam tincidunt consectetur risus, vel hendrerit justo suscipit in. Aenean pretium leo mi. Duis sollicitudin, ante a porta blandit, erat sem tempor nulla, id finibus nisi eros sit amet odio</p>
            <br>

            <!-- POPULATION BY GENDER -->
            {% if chart_data %}
            <div>
              <canvas id="myChart5"></canvas>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

            <script>
            const ctx5 = document.getElementById('myChart5');
            new Chart(ctx5, {
              type: 'bar',
              data: {
                labels: [
                  {% for data in chart_data %}
                  '{{ data.year }}',
                  {% endfor %}
                ],
                datasets: [
                  {
                    label: 'Male Population',
                    data: [
                      {% for data in chart_data %}
                      '{{ data.population_male }}',
                      {% endfor %}
                    ],
                    backgroundColor: 'rgba(255, 99, 132, 0.2)', 
                    borderColor: 'rgba(255, 99, 132, 1)', 
                    borderWidth: 1,
                    stack: 'population'
                  },
                  {
                    label: 'Female Population',
                    data: [
                      {% for data in chart_data %}
                      '{{ data.population_female }}',
                      {% endfor %}
                    ],
                    backgroundColor: 'rgba(54, 162, 235, 0.2)', 
                    borderColor: 'rgba(54, 162, 235, 1)', 
                    borderWidth: 1,
                    stack: 'population'
                  }
                ]
              },
              options: {
              }
            });
            </script>
            {% endif %}
            <br>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut et sodales mi. Sed ut tempor erat. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Aliquam tincidunt consectetur risus, vel hendrerit justo suscipit in. Aenean pretium leo mi. Duis sollicitudin, ante a porta blandit, erat sem tempor nulla, id finibus nisi eros sit amet odio</p>
            <br>
            
            


          <!-- COMMENTS SECTION -->
          <div class="comments">
            <h3 class="singleProject__subtitle">Feedback</h3>
            <h5 class="project--rating">
              {{dataset.vote_ratio}}% Positive Feedback ({{dataset.vote_total}} Vote{{dataset.vote_total|pluralize:"s"}})
            </h5>

        {% if user.is_authenticated %}
          {% if has_reviewed %}
            <p>You have already submitted a Vote/Comment!</p>

                  <!-- If they haven't left a review allow form submission -->
          {% elif request.user.is_authenticated %}
              <form class="form" action="{% url 'dataset' dataset.id_num %}" method="POST">
                  {% csrf_token %}
                  {% for field in form %}
                      <div class="form__field">
                          <label for="formInput#textarea">{{field.label}}</label>
                          {{field}}
                      </div>
                  {% endfor %}
                  <input class="btn btn--sub btn--lg" type="submit" value="Vote/Comment" />
              </form>
              <!-- If they're not logged in take to login page then reroute back to where they were. -->
            {% endif %}
          {% else %}
          <a href="{% url 'login' %}?next={{request.path}}">You must login to Vote/Comment!</a>
          
        {% endif %}
            
            <div class="commentList">
              {% for review in dataset.review_set.all %}
              {% if review.reviewBody %}
              <div class="comment">
                  <a href="{% url 'user-profile' review.owner.id_num  %}">
                      <img class="avatar avatar--md" src="{{review.owner.profile_image.url}}" alt="user" />
                  </a>


                  <div class="comment__details">
                      <a href="{% url 'user-profile' review.owner.id_num  %}"
                          class="comment__author">{{review.owner.username}}</a>
                      <p class="comment__info">{{review.reviewBody|linebreaksbr}}</p>
                  </div>

              </div>
              {% endif %}
              {% endfor %}

              </div>
            </div>
          </div>
        </div>
  </main>
{% endblock content %}